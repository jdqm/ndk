## Java、JNI交互

##### 一、Java调用JNI方法
其实在AS帮助我们创建的工程里，就已经向我们阐述了java如何调用native方法。

1、加载so库，选择合适的时机加载需要使用的so库，例如在静态代码块中直接加载。
```
// Used to load the 'native-lib' library on application startup.
static {
    System.loadLibrary("native-lib");
}
```

2、调用Java中通过native声明的方法，最终会调用到native中的C/C++代码。

##### 二、JNI调用Java实例方法

```
public void sayHello() {
    Log.d(TAG, "Hello I am Java method.");
}

```

```
extern "C" 
JNIEXPORT void JNICALL
Java_com_jdqm_ndktutorials_MainActivity_callJavaMethod(JNIEnv *env, jobject thiz) {
    jclass jclazz = env->FindClass("com/jdqm/ndktutorials/MainActivity");
    jmethodID jmethodId = env->GetMethodID(jclazz, "sayHello", "()V");
    env->CallVoidMethod(thiz, jmethodId);
}
```

这个例子是在native层调用了Java的实例方法seyHello()，分3步：
1、找到jclass;

2、找到jclass中对应的方法；

3、调用方法

##### 三、JNI调用Java静态方法
```
public static void staticSayHello() {
    Log.d(TAG, "Hello I am Java static method.");
}
```

```
extern "C"
JNIEXPORT void JNICALL
Java_com_jdqm_ndktutorials_MainActivity_callJavaStaticMethod(JNIEnv *env, jclass clazz) {
    jclass jclazz = env->FindClass("com/jdqm/ndktutorials/MainActivity");
    jmethodID jmethodId = env->GetStaticMethodID(jclazz, "staticSayHello", "()V");
    env->CallStaticVoidMethod(jclazz, jmethodId);
}
```
步骤其实和实例方法差不多，只不过调用env中的方法时，多了Static。值得一提的是，静态native方法```JNIEnv *env, jclass clazz```第二个参数是jclass，对应的是声明native方法的Class对象，而实例方法则是jobject，对应的是声明native方法类的实例对象。







